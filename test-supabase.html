<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Supabase</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
</head>
<body>
    <h1>Teste de Conexão Supabase</h1>
    <div id="status">Testando...</div>
    <div id="logs"></div>

    <script>
        const SUPABASE_URL = 'https://ymislcrrkcroahikwcm.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltaXNsY3Jya2Nyb2VhaGlrd2NtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODMwMzMsImV4cCI6MjA3MjY1OTAzM30.3usCMB-JMaHNgzhNW7Tolp2oOz8BzqV5yDLA69BFV_Q';
        
        function log(message) {
            console.log(message);
            document.getElementById('logs').innerHTML += '<p>' + message + '</p>';
        }
        
        async function testSupabase() {
            try {
                log('1. Verificando se Supabase está carregado...');
                if (typeof window.supabase === 'undefined') {
                    log('❌ Biblioteca Supabase não encontrada');
                    return;
                }
                log('✅ Biblioteca Supabase carregada');
                
                log('2. Testando conectividade básica...');
                try {
                    const response = await fetch('https://ymislcrrkcroahikwcm.supabase.co/rest/v1/', {
                        method: 'HEAD',
                        headers: {
                            'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InltaXNsY3Jya2Nyb2VhaGlrd2NtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODMwMzMsImV4cCI6MjA3MjY1OTAzM30.3usCMB-JMaHNgzhNW7Tolp2oOz8BzqV5yDLA69BFV_Q'
                        }
                    });
                    
                    if (response.ok) {
                        log('✅ Conectividade com Supabase OK');
                    } else {
                        log('❌ Erro HTTP: ' + response.status + ' - ' + response.statusText);
                    }
                } catch (err) {
                    log('❌ Erro de conectividade: ' + err.message);
                    console.error('Erro de rede:', err);
                }
                
                log('3. Criando cliente Supabase...');
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                log('✅ Cliente Supabase criado');
                
                log('4. Testando consulta à tabela acampamentos...');
                const { data, error } = await supabase.from('acampamentos').select('count').limit(1);
                
                if (error) {
                    log('❌ Erro na consulta: ' + error.message);
                    log('Código do erro: ' + error.code);
                    log('Detalhes: ' + JSON.stringify(error, null, 2));
                    
                    if (error.message.includes('relation') && error.message.includes('does not exist')) {
                        log('ℹ️ Tabela "acampamentos" não existe no banco');
                    }
                } else {
                    log('✅ Conexão bem-sucedida!');
                    log('Dados retornados: ' + JSON.stringify(data, null, 2));
                }
                
                log('5. Testando autenticação...');
                const { data: authData, error: authError } = await supabase.auth.getSession();
                
                if (authError) {
                    log('❌ Erro na autenticação: ' + authError.message);
                } else {
                    log('✅ Sistema de autenticação funcionando');
                    log('Sessão atual: ' + (authData.session ? 'Logado' : 'Não logado'));
                }
                
                document.getElementById('status').innerHTML = '✅ Teste concluído - verifique os logs';
                
            } catch (error) {
                log('❌ Erro geral: ' + error.message);
                log('Stack trace: ' + error.stack);
                document.getElementById('status').innerHTML = '❌ Erro no teste';
            }
        }
        
        // Executar teste quando a página carregar
        window.addEventListener('load', () => {
            setTimeout(testSupabase, 500);
        });
    </script>
</body>
</html>